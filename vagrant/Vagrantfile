Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/focal64"
  config.vm.network "forwarded_port", guest: 5000, host: 5000

  config.vm.provision "shell", inline: <<-SHELL
    sudo apt-get update -y
    sudo apt-get install -y python3 python3-pip
    pip3 install flask
    mkdir -p /home/vagrant/app
    cat > /home/vagrant/app/app.py <<'PY'
from flask import Flask
app = Flask(__name__)
@app.route("/")
def home():
    return "Hello World!"
@app.route("/healthz")
def health():
    return "ok", 200
if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
PY
    nohup python3 /home/vagrant/app/app.py > /home/vagrant/flask.log 2>&1 &
  SHELL
end
